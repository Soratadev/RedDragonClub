<div class="w-72">
  <div class="rounded bg-yellow-100 opacity-75 border border-gray-950">
    <h4 class="bg-red-500 text-white text-center"> {{ message }}</h4>
    <form action="" [formGroup]="bgForm()" (ngSubmit)="addBg()">
      <div id="row" class="m-1 p-1">
        <div class="input-group">
          <p><label for="name" class="font-bold">Name: </label></p>
          <input type="text" id="name" name="name" placeholder=" Name" formControlName="Name" class="border border-gray-950">
        </div>
        @if(this.bgForm().get('Name')?.dirty && this.bgForm().get('Name')?.invalid){
          <div class="text-red-500" *ngIf="this.bgForm().get('Name')?.getError('required')">Name is required</div>
        }
        <div class="input-group">
          <p><label for="designer" class="font-bold">Designer: </label></p>
          <input type="text" id="designer" name="designer" placeholder=" Designer" formControlName="Designer" class="border border-gray-950">
        </div>
        <div class="input-group">
          <p><label for="players" class="font-bold">Players: </label></p>
          <input type="text" id="players" name="players" placeholder=" Players" formControlName="Players" class="border border-gray-950">
        </div>
        <div class="input-group">
          <p><label for="playing_time" class="font-bold">Playing time : </label></p>
          <input type="text" id="playing_time" name="playing_time" placeholder=" Playing time" formControlName="Playing_time" class="border border-gray-950">
        </div>
        <div class="input-group">
          <p><label for="category" class="font-bold">Category: </label></p>
          <!--<input type="text" id="category" name="category" placeholder=" Category" formControlName="Category" class="border border-gray-950">-->
          <select
            id="category"
            name="category"
            (change)="onCategorySelect($event)"
            class="border border-gray-950 p-1 truncate">
            <option value="">Select one or more categories</option>
            @for(category of categories; track category.id) {
              <option [value]="category.id"
                      [style.display]="isOptionVisible(category) ? 'block' : 'none'">
                {{category.name}}
              </option>
            }
          </select>

          <!-- Container for the selected categories-->
          <div class="flex flex-wrap gap-2 mt-2 mb-1">
            @for(category of selectedCategories; track category.id) {
              <div class="flex items-center bg-blue-100 rounded-full px-3 py-1">
                <span class="text-sm">{{category.name}}</span>
                <button
                  type="button"
                  class="ml-2 text-red-500 hover:text-red-700"
                  (click)="removeCategory(category)">
                  Ã—
                </button>
              </div>
            }
          </div>

          <!-- Validated message if the user didn't select any category -->
          @if(bgForm().get('Category')?.touched && bgForm().get('Category')?.invalid) {
            <div class="text-red-500 text-sm mt-1">You must select at least one category</div>
          }
          @if(categories.length === 0) {
            <div class="text-yellow-600 text-sm mt-1">Loading categories...</div>
          }
        </div>

        <div class="input-group">
          <p><label for="complexity" class="font-bold">Complexity: </label></p>
          <input type="text" id="complexity" name="complexity" placeholder=" Complexity" formControlName="Complexity" class="border border-gray-950">
        </div>
        <div class="input-group">
          <p><label for="age" class="font-bold">Age: </label></p>
          <input type="text" id="age" name="age" placeholder=" Age" formControlName="Age" class="border border-gray-950">
        </div>
        <div class="input-group">
          <p><label for="cover" class="font-bold">Cover: </label></p>
          <select id="cover" name="cover" formControlName="Cover" class="border border-gray-950">
            <option value="" disabled selected></option>
            <option value="assets/img/7wonders.jpeg">7 Wonders</option>
            <option value="https://github.com/Soratadev/RedDragonClub/blob/main/src/assets/img/arkham-horror.jpeg?raw=true">Arkham Horror</option>
            <option value="https://github.com/Soratadev/RedDragonClub/blob/main/src/assets/img/azul.jpeg?raw=true">Azul</option>
            <option value="https://github.com/Soratadev/RedDragonClub/blob/main/src/assets/img/blood-rage.jpeg?raw=true">Blood Rage</option>
            <option value="https://github.com/Soratadev/RedDragonClub/blob/main/src/assets/img/carcassonne.jpeg?raw=true">Carcassonne</option>
            <option value="https://github.com/Soratadev/RedDragonClub/blob/main/src/assets/img/catan.jpeg?raw=true">Catan</option>
            <option value="https://github.com/Soratadev/RedDragonClub/blob/main/src/assets/img/descent.jpg?raw=true">Descent</option>
            <option value="https://github.com/Soratadev/RedDragonClub/blob/main/src/assets/img/dice-forge.jpg?raw=true">Dice Forge</option>
            <option value="https://github.com/Soratadev/RedDragonClub/blob/main/src/assets/img/dixit.jpg?raw=true">Dixit</option>
            <option value="https://github.com/Soratadev/RedDragonClub/blob/main/src/assets/img/dominion.jpg?raw=true">Dominion</option>
            <option value="https://github.com/Soratadev/RedDragonClub/blob/main/src/assets/img/gloomhaven.jpg?raw=true">Gloomhaven</option>
            <option value="https://github.com/Soratadev/RedDragonClub/blob/main/src/assets/img/lotr-journey.jpg?raw=true">LOTR Journeys</option>
            <option value="https://github.com/Soratadev/RedDragonClub/blob/main/src/assets/img/mage-knight.jpeg?raw=true">Mage Knight</option>
            <option value="https://github.com/Soratadev/RedDragonClub/blob/main/src/assets/img/mansion-of-madness.jpg?raw=true">Mansion of Madness</option>
            <option value="https://github.com/Soratadev/RedDragonClub/blob/main/src/assets/img/pandemic.jpg?raw=true">Pandemic</option>
            <option value="https://github.com/Soratadev/RedDragonClub/blob/main/src/assets/img/smallworld.jpg?raw=true">Small World</option>
            <option value="https://github.com/Soratadev/RedDragonClub/blob/main/src/assets/img/stone-age.jpg?raw=true">Stone Age</option>
            <option value="https://github.com/Soratadev/RedDragonClub/blob/main/src/assets/img/sw-rebellion.jpg?raw=true">Star Wars: Rebellion</option>
            <option value="https://github.com/Soratadev/RedDragonClub/blob/main/src/assets/img/talisman.jpg?raw=true">Talisman</option>
            <option value="https://github.com/Soratadev/RedDragonClub/blob/main/src/assets/img/terraforming-mars.jpg?raw=true">Terraforming Mars</option>
            <option value="https://github.com/Soratadev/RedDragonClub/blob/main/src/assets/img/ticket-to-ride.jpeg?raw=true">Ticket to Ride: Europa</option>
            <option value="https://github.com/Soratadev/RedDragonClub/blob/main/src/assets/img/twilight-imperium.jpeg?raw=true">Twilight Imperium</option>
            <option value="https://github.com/Soratadev/RedDragonClub/blob/main/src/assets/img/war-of-the-ring.jpg?raw=true">War of the Ring</option>
            <option value="https://github.com/Soratadev/RedDragonClub/blob/main/src/assets/img/wingspan.jpg?raw=true">Wingspan</option>
            <option value="https://github.com/Soratadev/RedDragonClub/blob/main/src/assets/img/zombicide.jpeg?raw=true">Zombicide</option>
          </select>
        </div>
        <div class="input-group">
          <p><label for="description" class="font-bold">Description: </label></p>
          <textarea id="description" name="description" placeholder="Description" formControlName="Description" class="border border-gray-950"></textarea>
        </div>
        <div class="flex justify-center">
          <button type="submit"
                  [disabled]="bgForm().invalid"
                  [ngClass]="{'opacity-50 cursor-not-allowed': bgForm().invalid,
                              'bg-green-200 hover:bg-green-400': bgForm().valid}"
                  class="rounded my-4 p-2 border-2 border-gray-950 font-bold">{{ textButton() }}
          </button>
        </div>
      </div>
    </form>
  </div>
</div>

